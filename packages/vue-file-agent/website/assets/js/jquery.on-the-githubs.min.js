/*! on-the-githubs 2016-05-23 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(){var b=c(this),g=f.settings;return isNaN(b.datetime)||(0==g.cutoff||e(b.datetime)<g.cutoff)&&a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return d(b instanceof Date?b:"string"==typeof b?a.timeago.parse(b):"number"==typeof b?new Date(b):a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow);var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(c)},datetime:function(b){var c=f.isTime(b)?a(b).attr("datetime"):a(b).attr("title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&setInterval(c,d.refreshMillis)},update:function(c){a(this).data("timeago",{datetime:f.parse(c)}),b.apply(this)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this},document.createElement("abbr"),document.createElement("time")}),function(a){a.fn.onthegithubs=function(b){var c=a.extend({},b||{}),d=function(a){var b=a;return b=b.replace(/\/users\//,"/"),b=b.replace(/\/repos\//,"/"),b=b.replace(/\/api\./,"/"),b=b.replace(/\/commits\//,"/commit/")},e=function(a,b){return a.replace(/\{([^\}]*)\}/g,function(a,c){return b.hasOwnProperty(c)?b[c]:""})},f=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},g=function(b){if(!b)throw Error('Please set an event source like "orgs/tus" via data-event-source attr or options');var c=a.Deferred(),d=localStorage.getItem("on-the-githubs-feed-"+b),e=localStorage.getItem("on-the-githubs-date-"+b),f=+new Date/1e3,g="https://api.github.com/"+b+"/events?per_page=20&callback=?";return d=JSON.parse(d),d&&d.data&&e&&180>f-e?(c.resolve(d),c):(a.getJSON(g,function(a,d,e){if(a.data.message)throw Error("GitHub says: "+a.data.message+" for url: "+g);a.data=a.data.slice(0,20),localStorage.setItem("on-the-githubs-feed-"+b,JSON.stringify(a)),localStorage.setItem("on-the-githubs-date-"+b,f),c.resolve(a)}),c)};return this.each(function(){var b,h,i=a(this);(h=c["event-source"])?b=h:(h=i.data("event-source"))&&(b=h),g(b).done(function(b){i.html("");var c='<abbr class="timeago" title="{created}">{created}</abbr>';c+='<img src="{gravatarSrc}" class="gravatar" />',c+='<p><a target="_blank" href="{userUrl}" class="author">{username}</a> ',c+="<span>{action}</span>",c+=' <a target="_blank" href="{repoUrl}">{repoName}</a>{branch}{commits}</p>',c+='<div class="clearfix"></div>';for(var g=0;g<b.data.length;g++){var h=b.data[g],j=h.actor.avatar_url,k=h.actor.login,l="",m="",n="",o=!1;switch(h.type){case"IssuesEvent":o="closed"===h.payload.issue.state,l=h.payload.action+" ",l+='issue <a target="_blank" href="'+h.payload.issue.html_url+'">',o&&(l+="<s>"),l+=h.payload.issue.title,o&&(l+="</s>"),l+="</a> on";break;case"CommitCommentEvent":l="commented “"+f(h.payload.comment.body)+"” ",l+='on a commit to <a target="_blank" href="'+h.payload.comment.html_url+'">',l+=h.payload.comment.path+"</a> in";break;case"IssueCommentEvent":o="closed"===h.payload.issue.state,l='commented on <a target="_blank" href="'+h.payload.comment.html_url+'">',o&&(l+="<s>"),l+=f(h.payload.issue.title),o&&(l+="</s>"),l+="</a> in";break;case"PushEvent":if(!h.payload||!h.payload.commits||0===h.payload.commits.length)break;var p=h.payload.commits[0].sha,q=d(h.payload.commits[0].url),r="",s=[],t="";for(var u in h.payload.commits)r=h.payload.commits[u].sha,t=h.payload.commits[u].message.substr(0,50),t.length>h.payload.commits[u].message.length&&(t+=" ..."),t=f(t),s.push(t);var v=q.replace("commit","compare").replace(p,p+"..."+r),w=s.join(" &mdash; ");w=f(w),l="pushed ",1===h.payload.commits.length?(l+='<a target="_blank" rel="tooltip" data-placement="right" title="'+w+'" href="'+q+'">',l+="1 commit",l+="</a>"):(l+='<a target="_blank" rel="tooltip" data-placement="right" title="'+w+'" href="'+v+'">',l+=h.payload.commits.length+" commits",l+="</a>"),l+=" to";break;case"ForkEvent":l="forked";break;case"WatchEvent":l="<span class='starred-text'>starred</span>";break;case"PullRequestEvent":l=h.payload.action+" ",l+='pull request <a target="_blank" href="'+h.payload.pull_request.html_url+'">',l+=h.payload.pull_request.title,l+="</a> for";break;case"CreateEvent":l="created a new "+h.payload.ref_type+" in",m=': <a target="_blank" href="https://github.com/'+h.repo.name+"/tree/"+h.payload.ref+'">'+h.payload.ref+"</a>";break;default:console.log(h.type,h)}var x=e(c,{gravatarSrc:j,userUrl:d(h.actor.url),username:k,repoUrl:d(h.repo.url),repoName:h.repo.name,branch:m,created:h.created_at,action:l,commits:n});a("<li/>").append(x).appendTo(i)}"timeago"in a("abbr.timeago")&&a("abbr.timeago").timeago(),"tooltip"in a("a[rel]")&&a("a[rel]").tooltip()})})}}(jQuery);